---
phase: 01-project-setup-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - packages/client/package.json
  - packages/client/tsconfig.json
  - packages/client/tsconfig.app.json
  - packages/client/tsconfig.node.json
  - packages/client/vite.config.ts
  - packages/client/vitest.config.ts
  - packages/client/index.html
  - packages/client/components.json
  - packages/client/src/main.tsx
  - packages/client/src/App.tsx
  - packages/client/src/index.css
  - packages/client/src/vite-env.d.ts
  - packages/client/src/components/ThemeProvider.tsx
  - packages/client/src/components/ui/button.tsx
  - packages/client/src/store/index.ts
  - packages/client/src/store/hooks.ts
  - packages/client/src/features/health/api.ts
  - packages/client/src/pages/Home.tsx
  - packages/client/src/lib/utils.ts
  - packages/client/src/__tests__/App.test.tsx
  - packages/server/src/index.ts
  - vitest.config.ts
autonomous: true

must_haves:
  truths:
    - "React client renders in browser with Tailwind styling applied"
    - "Dark/light theme toggle works (system preference + manual override)"
    - "Redux store is configured with typed hooks (useAppDispatch, useAppSelector)"
    - "RTK Query health endpoint fetches /api/health and displays result"
    - "Single-port dev experience: Express serves Vite middleware on port 3000"
    - "Client-side routing works (React Router, / route renders Home page)"
    - "Root vitest config runs tests across both client and server packages"
  artifacts:
    - path: "packages/client/vite.config.ts"
      provides: "Vite configuration with React, Tailwind, path alias"
      contains: "react()"
    - path: "packages/client/src/store/index.ts"
      provides: "Redux store with RTK Query middleware"
      exports: ["store", "RootState", "AppDispatch"]
    - path: "packages/client/src/store/hooks.ts"
      provides: "Typed Redux hooks"
      exports: ["useAppDispatch", "useAppSelector"]
    - path: "packages/client/src/features/health/api.ts"
      provides: "RTK Query endpoint for health check"
      exports: ["healthApi", "useHealthQuery"]
    - path: "packages/client/src/components/ThemeProvider.tsx"
      provides: "Dark/light mode context with system preference and localStorage"
      exports: ["ThemeProvider", "useTheme"]
    - path: "packages/client/src/App.tsx"
      provides: "Root React component with Router and Providers"
      min_lines: 15
    - path: "vitest.config.ts"
      provides: "Root Vitest config running all workspace projects"
      contains: "projects"
  key_links:
    - from: "packages/client/src/main.tsx"
      to: "packages/client/src/App.tsx"
      via: "React root render"
      pattern: "createRoot.*App"
    - from: "packages/client/src/App.tsx"
      to: "packages/client/src/store/index.ts"
      via: "Redux Provider wrapping app"
      pattern: "Provider.*store"
    - from: "packages/client/src/App.tsx"
      to: "packages/client/src/components/ThemeProvider.tsx"
      via: "ThemeProvider wrapping app"
      pattern: "ThemeProvider"
    - from: "packages/client/src/features/health/api.ts"
      to: "/api/health"
      via: "RTK Query fetchBaseQuery"
      pattern: "fetchBaseQuery.*baseUrl.*api"
    - from: "packages/server/src/index.ts"
      to: "packages/client"
      via: "Vite middleware in dev mode"
      pattern: "createViteServer|vite.*middlewareMode"
    - from: "packages/client/src/store/index.ts"
      to: "packages/client/src/features/health/api.ts"
      via: "RTK Query reducer and middleware registration"
      pattern: "healthApi\\.reducer.*healthApi\\.middleware"
---

<objective>
Create the React client package with Vite, Tailwind CSS, shadcn/ui, Redux Toolkit store, RTK Query, React Router, and dark/light theme support. Integrate Vite middleware into Express for single-port development. Set up root Vitest configuration for monorepo testing.

Purpose: Completes the full-stack skeleton so both client and server run from a single `npm run dev` command. Establishes all frontend patterns (state management, styling, routing, theming) that future phases build upon.

Output: Working React SPA served through Express, with Tailwind styling, theme toggle, Redux store, and RTK Query wired to the health endpoint.
</objective>

<execution_context>
@/Users/alexanderfedin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/alexanderfedin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-project-setup-foundation/01-CONTEXT.md
@.planning/phases/01-project-setup-foundation/01-RESEARCH.md
@.planning/phases/01-project-setup-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: React client with Vite, Tailwind, shadcn/ui, Redux, and Router</name>
  <files>
    packages/client/package.json
    packages/client/tsconfig.json
    packages/client/tsconfig.app.json
    packages/client/tsconfig.node.json
    packages/client/vite.config.ts
    packages/client/vitest.config.ts
    packages/client/index.html
    packages/client/components.json
    packages/client/src/main.tsx
    packages/client/src/App.tsx
    packages/client/src/index.css
    packages/client/src/vite-env.d.ts
    packages/client/src/lib/utils.ts
    packages/client/src/components/ThemeProvider.tsx
    packages/client/src/components/ui/button.tsx
    packages/client/src/store/index.ts
    packages/client/src/store/hooks.ts
    packages/client/src/features/health/api.ts
    packages/client/src/pages/Home.tsx
    packages/client/src/__tests__/App.test.tsx
  </files>
  <action>
    Create packages/client/package.json:
    - name: "@repo/client"
    - version: "0.0.0"
    - type: "module"
    - private: true
    - scripts: dev ("vite"), build ("tsc -b && vite build"), preview ("vite preview"), test ("vitest run"), "test:watch" ("vitest")
    - dependencies: react (^18.3.x), react-dom (^18.3.x), react-router (^7.x), react-router-dom (^7.x), @reduxjs/toolkit (^2.x), react-redux (^9.x), @repo/shared ("*")
    - devDependencies: vite (^6.x), @vitejs/plugin-react (^4.x), @types/react (^18.x), @types/react-dom (^18.x), tailwindcss (^4.x), @tailwindcss/vite (latest), @types/node (^22.x), vitest (^3.x), jsdom (latest)
    - Note: Use React 18.3 (stable) per research recommendation. Not React 19 (canary).

    Create packages/client/tsconfig.json (solution-style):
    - files: []
    - references: [{ "path": "./tsconfig.app.json" }, { "path": "./tsconfig.node.json" }]
    - compilerOptions: { baseUrl: ".", paths: { "@/*": ["./src/*"] } }

    Create packages/client/tsconfig.app.json:
    - composite: true
    - target: "ES2020", lib: ["ES2020", "DOM", "DOM.Iterable"]
    - module: "ESNext", moduleResolution: "bundler"
    - jsx: "react-jsx"
    - strict: true, noUnusedLocals: true, noUnusedParameters: true, noFallthroughCasesInSwitch: true, noUncheckedIndexedAccess: true
    - skipLibCheck: true, resolveJsonModule: true, isolatedModules: true
    - references: [{ "path": "../shared" }]
    - include: ["src"]

    Create packages/client/tsconfig.node.json:
    - composite: true
    - module: "ESNext", moduleResolution: "bundler"
    - allowSyntheticDefaultImports: true
    - include: ["vite.config.ts"]

    Create packages/client/vite.config.ts:
    - plugins: [react(), tailwindcss()] -- import from @vitejs/plugin-react and @tailwindcss/vite
    - resolve.alias: { "@": path.resolve(__dirname, "./src") }
    - Do NOT configure proxy or server port (Vite runs via Express middleware, not standalone)

    Create packages/client/vitest.config.ts:
    - name: "client", environment: "jsdom", globals: true
    - plugins: [react()]
    - resolve.alias matching vite.config.ts
    - include: ["src/__tests__/**/*.test.{ts,tsx}"]
    - setupFiles: [] (add if needed later)

    Create packages/client/index.html:
    - Standard Vite HTML template with <div id="root"></div>
    - Title: "Hapyy Languages Web Portal"
    - Script module src: /src/main.tsx

    Create packages/client/src/vite-env.d.ts:
    - Triple-slash reference to "vite/client"

    Create packages/client/src/index.css:
    - @import "tailwindcss" (Tailwind v4 syntax)
    - CSS custom properties for shadcn/ui theming (light and dark themes)
    - Use the default shadcn/ui CSS variables for colors (background, foreground, primary, secondary, muted, accent, destructive, border, ring, etc.)
    - Include .dark class selector with dark theme variable values
    - Use polished, vibrant color palette (per user's Stripe/Tailwind aesthetic request) -- brighter primary colors than default shadcn

    Create packages/client/src/lib/utils.ts:
    - cn() utility function using clsx and tailwind-merge (standard shadcn/ui pattern)
    - Install clsx and tailwind-merge as client dependencies

    Run `npx shadcn@latest init` in packages/client/ (or manually create components.json):
    - components.json: { "$schema": "https://ui.shadcn.com/schema.json", "style": "new-york", "rsc": false, "tsx": true, "tailwind": { "config": "", "css": "src/index.css", "baseColor": "zinc", "cssVariables": true }, "aliases": { "components": "@/components", "utils": "@/lib/utils", "ui": "@/components/ui", "lib": "@/lib", "hooks": "@/hooks" } }
    - Run `npx shadcn@latest add button` to add first component (proves shadcn/ui pipeline works)

    Create packages/client/src/components/ThemeProvider.tsx:
    - Theme type: "dark" | "light" | "system"
    - ThemeContext with theme and setTheme
    - ThemeProvider component:
      * Initialize from localStorage key "hapyy-theme", default "system"
      * useEffect: update document.documentElement classList (remove "light"/"dark", add resolved theme)
      * For "system": use window.matchMedia("(prefers-color-scheme: dark)") and add listener for changes
      * Persist to localStorage on change
    - Export useTheme() hook

    Create packages/client/src/store/index.ts:
    - configureStore with healthApi reducer and middleware
    - Export RootState (ReturnType<typeof store.getState>) and AppDispatch (typeof store.dispatch)
    - Export store

    Create packages/client/src/store/hooks.ts:
    - useAppDispatch: typed useDispatch<AppDispatch>
    - useAppSelector: TypedUseSelectorHook<RootState>

    Create packages/client/src/features/health/api.ts:
    - createApi with reducerPath "healthApi"
    - fetchBaseQuery with baseUrl "/api"
    - Endpoint: getHealth query returning HealthResponse from @repo/shared
    - Export useHealthQuery (auto-generated hook)

    Create packages/client/src/pages/Home.tsx:
    - Simple landing page skeleton showing:
      * "Hapyy Languages Web Portal" heading
      * Brief description text
      * Health status indicator using useHealthQuery() -- green dot + "Connected" or red dot + "Disconnected"
      * Theme toggle button (using shadcn/ui Button component)
    - Styled with Tailwind: centered content, responsive, uses theme colors
    - This is a proof-of-life page, not the final landing page (that's Phase 6)

    Create packages/client/src/App.tsx:
    - Provider wrap order: Redux Provider (store) > ThemeProvider > BrowserRouter > Routes
    - Route "/" -> Home page
    - Route "*" -> simple 404 text (placeholder)

    Create packages/client/src/main.tsx:
    - StrictMode > App
    - Import index.css
    - createRoot(document.getElementById("root")!).render(...)

    Create packages/client/src/__tests__/App.test.tsx:
    - Test that App renders without crashing (render <App />, check for heading text)
    - Need to wrap in Provider and MemoryRouter for test
    - Mock the health API fetch (or use MSW if simple enough without it)

    Run npm install from root to install client dependencies.
    Run tsc --build from root to verify full monorepo compilation.
    Run npm run test -w @repo/client to verify client test passes.
  </action>
  <verify>
    1. `npm run build` (root tsc --build) compiles all three packages without errors.
    2. `npm run test -w @repo/client` -- client test passes.
    3. `npm run build -w @repo/client` (Vite build) succeeds and produces packages/client/dist/index.html.
  </verify>
  <done>
    React client compiles, Tailwind styling works, shadcn/ui Button component renders, Redux store with RTK Query health endpoint is wired, theme toggle switches dark/light, and client test passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Vite-Express dev integration and root Vitest config</name>
  <files>
    packages/server/src/index.ts
    vitest.config.ts
  </files>
  <action>
    Update packages/server/src/index.ts to integrate Vite middleware for single-port development:
    - In dev mode (process.env.NODE_ENV !== "production"):
      * Dynamically import { createServer as createViteServer } from "vite"
      * Create Vite dev server with: server: { middlewareMode: true }, appType: "custom", root: path.resolve(import.meta.dirname || __dirname, "../../client")
      * Mount vite.middlewares AFTER API routes but BEFORE the catch-all
      * Note: Use dynamic import so vite is not a production dependency
    - In production mode:
      * Serve static files from packages/client/dist via express.static
      * Add catch-all GET * route that serves index.html (for client-side routing)
    - Ensure API routes (/api/*) are mounted BEFORE Vite middleware and static files
    - Add "vite" as a devDependency to packages/server/package.json (needed for dynamic import type)

    Create root vitest.config.ts:
    - import { defineConfig } from "vitest/config"
    - test.projects: ["packages/client", "packages/server", "packages/shared"]
    - This enables `npm test` from root to run all workspace tests

    Update root package.json scripts to include "dev" script that runs server in dev mode:
    - "dev": "npm run dev -w @repo/server" (single command starts Express + Vite)
    - "test": "vitest run" (runs all projects)
    - "test:watch": "vitest"
    - "typecheck": "tsc --build --noEmit" (type check all packages)

    Run npm install from root.
    Run npm run dev from root -- verify server starts on port 3000 and client renders in browser.
    Run npm test from root -- verify all tests pass across all packages.
  </action>
  <verify>
    1. `npm run dev` from root starts Express on port 3000 with Vite middleware.
    2. Open http://localhost:3000 in browser -- React app renders with "Hapyy Languages Web Portal" heading.
    3. Open http://localhost:3000/api/health -- returns JSON health response.
    4. `npm test` from root runs both client and server test suites, all pass.
    5. Kill dev server after verification.
  </verify>
  <done>
    Single-port development works: Express serves both API and Vite-proxied React client on port 3000. Root test command runs all package tests. Theme toggle and health status indicator function correctly.
  </done>
</task>

</tasks>

<verification>
- `npm run dev` starts full-stack app on single port (3000)
- Browser shows React app with Tailwind styling at http://localhost:3000
- Health check API at http://localhost:3000/api/health returns JSON
- Health status shown in React UI via RTK Query
- Theme toggle switches between dark and light mode
- `npm test` from root passes all tests (client + server)
- `npm run build` from root compiles all TypeScript without errors
</verification>

<success_criteria>
- React SPA renders via Vite middleware in Express (single port dev)
- Tailwind CSS classes apply correctly (visible styling)
- shadcn/ui Button component renders (proves component pipeline works)
- Redux store created with typed hooks
- RTK Query health endpoint fetches and displays server health
- Dark/light theme toggle persists to localStorage and applies CSS class
- React Router handles / route and 404 fallback
- All client and server tests pass from root `npm test`
</success_criteria>

<output>
After completion, create `.planning/phases/01-project-setup-foundation/01-02-SUMMARY.md`
</output>
