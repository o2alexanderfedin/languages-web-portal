---
phase: 07-e2e-testing
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - e2e/tests/landing-navigation.spec.ts
  - e2e/tests/upload-execute-results.spec.ts
  - e2e/tests/shareable-links.spec.ts
  - e2e/tests/responsive-layout.spec.ts
  - .github/workflows/playwright.yml
autonomous: true

must_haves:
  truths:
    - "Landing page loads and displays hero section with formal verification headline"
    - "User can navigate from landing page to demo via Try Now button and tool is pre-selected"
    - "User can navigate from landing page to demo via Quick Start CTA"
    - "User can upload a ZIP file on demo page and see success confirmation"
    - "User can select a tool and execute it after uploading"
    - "Execution streams output to console view and shows completion"
    - "Shareable link with ?tool= param pre-selects the correct tool on demo page"
    - "Landing page shows table layout on desktop and card layout on mobile"
    - "GitHub Actions workflow exists for CI E2E testing"
  artifacts:
    - path: "e2e/tests/landing-navigation.spec.ts"
      provides: "Landing page display and navigation tests"
      contains: "test"
    - path: "e2e/tests/upload-execute-results.spec.ts"
      provides: "Upload, execute, streaming, and results tests"
      contains: "test"
    - path: "e2e/tests/shareable-links.spec.ts"
      provides: "URL parameter and shareable link tests"
      contains: "test"
    - path: "e2e/tests/responsive-layout.spec.ts"
      provides: "Viewport responsive layout tests"
      contains: "test"
    - path: ".github/workflows/playwright.yml"
      provides: "GitHub Actions CI workflow for E2E tests"
      contains: "playwright"
  key_links:
    - from: "e2e/tests/landing-navigation.spec.ts"
      to: "e2e/pages/LandingPage.ts"
      via: "POM import"
      pattern: "import.*LandingPage"
    - from: "e2e/tests/upload-execute-results.spec.ts"
      to: "e2e/pages/DemoPage.ts"
      via: "POM import"
      pattern: "import.*DemoPage"
    - from: "e2e/tests/shareable-links.spec.ts"
      to: "e2e/pages/DemoPage.ts"
      via: "POM import"
      pattern: "import.*DemoPage"
---

<objective>
Write E2E test specs covering 4 critical user flows and create a GitHub Actions CI workflow.

Purpose: Verify the application's critical user journeys work end-to-end in a real browser, catching integration issues that unit tests miss.
Output: 4 test spec files covering landing navigation, upload-execute-results, shareable links, and responsive layout. Plus a CI workflow.
</objective>

<execution_context>
@/Users/alexanderfedin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/alexanderfedin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-add-end-to-end-ui-tests-with-playwright-covering-critical-user-flows-landing-demo-navigation-upload-execute-results-workflow-shareable-links-quick-start-cta-and-responsive-layout/07-RESEARCH.md
@.planning/phases/07-add-end-to-end-ui-tests-with-playwright-covering-critical-user-flows-landing-demo-navigation-upload-execute-results-workflow-shareable-links-quick-start-cta-and-responsive-layout/07-01-SUMMARY.md
@e2e/pages/LandingPage.ts
@e2e/pages/DemoPage.ts
@playwright.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write landing navigation and shareable link tests</name>
  <files>
    e2e/tests/landing-navigation.spec.ts
    e2e/tests/shareable-links.spec.ts
    e2e/tests/responsive-layout.spec.ts
  </files>
  <action>
    1. Create e2e/tests/landing-navigation.spec.ts with these test cases:
       - "landing page displays hero section with formal verification headline" — goto /, verify heading "Formal Verification for AI-Generated Code" visible
       - "landing page displays tool comparison grid with all tools" — goto /, verify tool grid visible, verify at least 2 tool rows visible on desktop (use desktop project), verify "C++ to C Transpiler" text visible
       - "landing page Try Now button navigates to demo with tool pre-selected" — goto /, click Try Now for cpp-to-c-transpiler, verify URL contains '/demo?tool=cpp-to-c-transpiler', verify tool-option-cpp-to-c-transpiler has selected styling (border-primary class or aria-selected)
       - "landing page Quick Start CTA navigates to demo with quickstart param" — goto /, click quickstart CTA, verify URL contains '/demo?tool=cpp-to-c-transpiler&quickstart=true'
       - "landing page footer link navigates to demo" — goto /, click footer "Try the Demo" link, verify URL is '/demo'
       - "demo page Back to Home link returns to landing" — goto /demo, click back-to-home link, verify URL is '/'
       Use LandingPage and DemoPage POMs. Use beforeEach for fresh page state. Use Web-First assertions (expect(locator).toBeVisible(), etc.) — never isVisible() checks.

    2. Create e2e/tests/shareable-links.spec.ts with these test cases:
       - "navigating to /demo?tool=cpp-to-c-transpiler pre-selects the tool" — goto /demo?tool=cpp-to-c-transpiler, verify tool-option-cpp-to-c-transpiler has selected state (e.g., border-primary class)
       - "navigating to /demo?tool=cpp-to-rust-transpiler pre-selects different tool" — goto /demo?tool=cpp-to-rust-transpiler, verify tool-option-cpp-to-rust-transpiler has selected state
       - "navigating to /demo without params shows no tool pre-selected" — goto /demo, verify no tool-option has border-primary (or verify execute button is disabled because no tool selected)
       - "navigating to /demo?tool=invalid-tool-id handles gracefully" — goto /demo?tool=nonexistent, verify page loads without errors (no crash), verify execute button is still present
       Use DemoPage POM.

    3. Create e2e/tests/responsive-layout.spec.ts with these test cases (use page.setViewportSize() per test for explicit control instead of relying on project config):
       - "desktop viewport shows tool comparison table" — setViewportSize 1280x720, goto /, verify tool-comparison-table is visible, verify tool-comparison-cards is NOT visible (hidden md:block pattern)
       - "mobile viewport shows tool comparison cards" — setViewportSize 375x667, goto /, verify tool-comparison-cards is visible, verify tool-comparison-table is NOT visible
       - "demo page layout is usable on mobile" — setViewportSize 375x667, goto /demo, verify upload-zone is visible, verify execution-panel is visible (basic usability, not pixel-perfect)
       Use LandingPage POM where applicable.

    4. Run all three spec files: `npx playwright test landing-navigation shareable-links responsive-layout`
    5. Fix any flaky or failing tests. Common issues:
       - If tool pre-selection check fails: check how ToolPicker indicates selection — look for border-primary class or aria-selected attribute on the tool-option div
       - If navigation tests fail: check that webServer is running and the routes match
       - If responsive tests fail: verify the actual Tailwind breakpoint classes (md:block / md:hidden)
  </action>
  <verify>
    - `npx playwright test landing-navigation shareable-links responsive-layout` — all tests pass
    - At least 10 test cases across the three files
    - No usage of waitForTimeout() (no hard-coded delays)
    - All tests use POM methods or data-testid locators (no fragile CSS selectors)
  </verify>
  <done>
    Landing navigation tests pass (hero display, Try Now navigation, Quick Start CTA, footer link, back navigation). Shareable link tests pass (tool pre-selection via URL params, invalid param handling). Responsive tests pass (table on desktop, cards on mobile, mobile demo usability).
  </done>
</task>

<task type="auto">
  <name>Task 2: Write upload-execute-results tests and CI workflow</name>
  <files>
    e2e/tests/upload-execute-results.spec.ts
    .github/workflows/playwright.yml
  </files>
  <action>
    1. Create e2e/tests/upload-execute-results.spec.ts with these test cases:
       - "user can upload a ZIP file and see success" — goto /demo, use DemoPage.uploadFile() with e2e/fixtures/test-files/sample.zip (use path.resolve for absolute path), wait for upload-success to be visible, verify "files extracted" text appears
       - "user can select a tool after uploading" — upload file, click tool-option-cpp-to-c-transpiler, verify tool option has selected styling
       - "execute button is disabled without upload and tool" — goto /demo, verify execute button is disabled (or has disabled attribute/aria-disabled)
       - "full workflow: upload, select tool, execute, see streaming output" — upload sample.zip, select cpp-to-c-transpiler, click execute button, wait for console-output to be visible, wait for console-output to contain text indicating completion (e.g., "exit code" or "completed" — use a lenient regex with 30s timeout since execution involves real process spawning). NOTE: This test requires the actual tool binaries to be available. If the tools are NOT installed in the dev environment, this test should be marked with test.skip() and a comment explaining it needs the Hapyy CLI tools. Instead, verify that: (a) execute button becomes enabled after upload + tool selection, (b) clicking execute shows the console view, (c) some kind of output or error appears (even an error like "tool not found" proves the E2E pipeline works).
       - "upload zone shows error for invalid file type" — attempt to upload a non-ZIP file. Create a small .txt file inline using fs.writeFileSync to a temp path, then setInputFiles(). Verify the error message appears. NOTE: react-dropzone may reject at client level before upload — verify the rejection error text "Only ZIP files are accepted" or similar.

       IMPORTANT: The upload-execute flow depends on the server being able to process files. If tests are flaky due to server timing, use generous timeouts (30s) for execution-related assertions. Use `test.slow()` annotation for the full workflow test.

    2. Create .github/workflows/playwright.yml:
       ```yaml
       name: Playwright Tests
       on:
         push:
           branches: [main, develop]
         pull_request:
           branches: [main, develop]
       jobs:
         test:
           timeout-minutes: 60
           runs-on: ubuntu-latest
           steps:
             - uses: actions/checkout@v4
             - uses: actions/setup-node@v4
               with:
                 node-version: '22'
             - name: Install dependencies
               run: npm ci
             - name: Build project
               run: npm run build
             - name: Install Playwright browsers
               run: npx playwright install --with-deps chromium
             - name: Run Playwright tests
               run: npx playwright test
             - uses: actions/upload-artifact@v4
               if: always()
               with:
                 name: playwright-report
                 path: playwright-report/
                 retention-days: 30
       ```

    3. Run all E2E tests together: `npx playwright test`
    4. If any tests fail, diagnose and fix. For the full workflow test, if tool binaries aren't available, convert to a partial test that verifies up to the execute button click and console appearance.
    5. Verify lint passes on all new files.
  </action>
  <verify>
    - `npx playwright test` — all tests pass across all spec files
    - `ls .github/workflows/playwright.yml` — CI workflow exists
    - Total test count across all specs: at least 15 test cases
    - Full workflow test either completes or is properly annotated with test.skip/test.fixme explaining tool binary dependency
  </verify>
  <done>
    Upload-execute-results tests pass (upload success, tool selection, execute button states, full workflow or partial with skip annotation). GitHub Actions workflow created for CI. All E2E tests pass locally. Total coverage: landing navigation, upload-execute flow, shareable links, responsive layout.
  </done>
</task>

</tasks>

<verification>
- `npx playwright test` passes all specs (or skipped tests are annotated with reason)
- At least 15 test cases across 4 spec files
- No hard-coded waits (no waitForTimeout)
- All tests use POMs or data-testid locators
- GitHub Actions workflow exists at .github/workflows/playwright.yml
- Tests cover all 5 critical flows: landing display, landing-to-demo navigation, upload-execute-results, shareable links, responsive layout
</verification>

<success_criteria>
- All E2E tests pass with `npx playwright test`
- Landing page hero, tool grid, navigation — all verified
- Upload + tool selection + execution flow tested end-to-end
- URL param tool pre-selection verified
- Desktop table vs mobile cards layout verified
- CI workflow ready for GitHub Actions
- No regression in existing vitest unit tests
</success_criteria>

<output>
After completion, create `.planning/phases/07-add-end-to-end-ui-tests-with-playwright-covering-critical-user-flows-landing-demo-navigation-upload-execute-results-workflow-shareable-links-quick-start-cta-and-responsive-layout/07-02-SUMMARY.md`
</output>
